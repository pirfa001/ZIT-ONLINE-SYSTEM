{% extends 'base.html' %}

{% block title %}{{ course.title }} | ZIT Learn Online{% endblock %}

{% block content %}
<!-- Hero -->
<section class="relative bg-gray-900 text-white py-20">
  <div class="absolute inset-0 bg-black bg-opacity-50"></div>
  <div class="container mx-auto relative z-10 text-center px-6" style="{% if course.image %}background-image: url('{{ course.image }}');{% endif %}background-position:center; background-size:cover;">
    <div class="flex items-center justify-center mb-6 text-sm">
      <a href="{{ url_for('courses') }}" class="text-blue-200 hover:text-blue-100">Courses</a>
      <span class="mx-2 text-gray-400">/</span>
      <span class="text-gray-300">{{ course.title }}</span>
    </div>
    <h1 class="text-4xl font-extrabold mb-3">{{ course.title }}</h1>
  <p class="text-lg font-semibold text-yellow-300 mb-2">Price: {% if (course.price or 0) == 0 %}Free{% else %}NGN {{ ('%.2f' % course.price) }}{% endif %}</p>
    <p class="max-w-2xl mx-auto text-gray-200 text-md leading-relaxed mb-8">
      {{ course.description }}
    </p>
    {% if current_user.is_authenticated and current_user.role == 'student' %}
      {% if (course.price or 0) <= 0 %}
        <a href="{{ url_for('enroll', course_id=course.id) }}" 
           class="mt-6 inline-block bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
           Enroll Now
        </a>
      {% else %}
        <a href="{{ url_for('start_payment', course_id=course.id) }}" 
           class="mt-6 inline-block bg-yellow-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-yellow-600 transition">
           Buy Now - NGN {{ ('%.2f' % course.price) }}
        </a>
      {% endif %}
    {% elif not current_user.is_authenticated %}
      <a href="{{ url_for('login') }}" 
         class="mt-6 inline-block bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
         Login to Enroll
      </a>
    {% endif %}
    {% if current_user.is_authenticated and current_user.role == 'instructor' and current_user.id == course.instructor_id %}
      <a href="{{ url_for('create_module', course_id=course.id) }}" 
         class="mt-6 ml-4 inline-block bg-green-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-700 transition">
         Add Module
      </a>
    {% endif %}
  </div>
</section>

<!-- Course Content -->
<section class="container mx-auto py-12 px-6">
  <h2 class="text-2xl font-bold mb-6 text-gray-800">Course Modules</h2>
  <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for module in modules %}
    <div class="bg-white p-5 rounded-xl shadow-md hover:shadow-lg transition transform hover:-translate-y-1">
      <h3 class="text-lg font-semibold text-blue-700 mb-2">Module {{ loop.index }}</h3>
      <p class="text-gray-600">{{ module.title }}</p>
      {% if current_user.is_authenticated and current_user.role == 'student' %}
        {% if module.id in completed_module_ids %}
          <div class="mt-4">
            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">Completed</span>
          </div>
        {% else %}
          <form method="post" action="{{ url_for('complete_module', module_id=module.id) }}" class="mt-4">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Mark as Complete</button>
          </form>
        {% endif %}
      {% endif %}
    </div>
    {% else %}
    <div class="col-span-3 text-center py-10">
      <p class="text-gray-600">No modules available for this course yet.</p>
    </div>
    {% endfor %}
  </div>
</section>

<!-- Quizzes -->
<section class="container mx-auto py-8 px-6">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-2xl font-bold text-gray-800">Quizzes</h2>
    {% if current_user.is_authenticated and current_user.role == 'instructor' and current_user.id == course.instructor_id %}
      <a href="{{ url_for('create_quiz', course_id=course.id) }}" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Create Quiz</a>
    {% endif %}
  </div>

  {% if quizzes %}
  <div class="grid md:grid-cols-2 gap-4">
    {% for quiz in quizzes %}
    <div class="bg-white p-4 rounded shadow-sm flex items-center justify-between">
      <div>
        <div class="font-semibold text-gray-800">{{ quiz.title }}</div>
        <div class="text-sm text-gray-500">Created {{ quiz.created_at.strftime('%Y-%m-%d') }}</div>
      </div>
      <div class="space-x-2">
        <a href="{{ url_for('view_quiz', quiz_id=quiz.id) }}" class="text-blue-600 hover:underline">Take/View</a>
        {% if current_user.is_authenticated and current_user.role == 'instructor' and current_user.id == course.instructor_id %}
          <a href="{{ url_for('quiz_results', quiz_id=quiz.id) }}" class="text-indigo-600 hover:underline">Results</a>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
    <p class="text-gray-600">No quizzes have been added to this course yet.</p>
  {% endif %}
</section>

<!-- Videos -->
<section class="container mx-auto py-8 px-6">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-2xl font-bold text-gray-800">Videos</h2>
    {% if current_user.is_authenticated and current_user.role == 'instructor' and current_user.id == course.instructor_id %}
      <a href="{{ url_for('upload_video', course_id=course.id) }}" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Upload Video</a>
    {% endif %}
  </div>

  {% if videos %}
  <div class="grid md:grid-cols-2 gap-4">
    {% for video in videos %}
    <div class="bg-white p-4 rounded shadow-sm flex items-center justify-between">
      <div>
        <div class="font-semibold text-gray-800">{{ video.title or video.original_filename }}</div>
        <div class="text-sm text-gray-500">Uploaded {{ video.created_at.strftime('%Y-%m-%d') }}</div>
      </div>
      <div class="space-x-2">
        <a href="{{ url_for('view_video', video_id=video.id) }}" class="text-blue-600 hover:underline">Watch</a>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
    <p class="text-gray-600">No videos uploaded for this course yet.</p>
  {% endif %}
</section>

<!-- Instructor Section -->
<section class="bg-blue-50 py-12">
  <div class="container mx-auto px-6">
    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Meet Your Instructor</h2>
    <div class="max-w-xl mx-auto bg-white shadow-lg rounded-2xl p-6 flex flex-col items-center">
      <div class="text-center">
        <h3 class="text-xl font-semibold mb-1">{{ course.instructor.full_name }}</h3>
        <p class="text-blue-700 font-medium mb-4">Instructor</p>
      </div>
    </div>
  </div>
</section>

<!-- Announcements Section -->
{% if announcements %}
<section class="container mx-auto py-12 px-6">
  <h2 class="text-2xl font-bold mb-6 text-gray-800">Course Announcements</h2>
  <div class="space-y-4">
    {% for announcement in announcements %}
    <div class="bg-white p-5 rounded-xl shadow-md">
      <p class="text-sm text-gray-500 mb-2">{{ announcement.created_at.strftime('%B %d, %Y') }}</p>
      <p class="text-gray-700">{{ announcement.message }}</p>
    </div>
    {% endfor %}
  </div>
</section>
{% endif %}
{% endblock %}
